<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="720" viewBox="0 0 1200 720">
  <defs>
    <style>
      .t1{font:700 20px 'Inter', 'Segoe UI', Arial, sans-serif; fill:#111827}
      .t2{font:600 14px 'Inter', 'Segoe UI', Arial, sans-serif; fill:#111827}
      .t3{font:500 12px 'Inter', 'Segoe UI', Arial, sans-serif; fill:#374151}
      .t4{font:600 12px 'Inter', 'Segoe UI', Arial, sans-serif; fill:#111827}
      .box{fill:#ffffff; stroke:#e5e7eb; stroke-width:2}
      .box2{fill:#f9fafb; stroke:#e5e7eb; stroke-width:2}
      .box3{fill:#111827; stroke:#111827; stroke-width:2}
      .muted{fill:#6b7280}
      .arrow{stroke:#111827; stroke-width:2; fill:none; marker-end:url(#m)}
      .arrow2{stroke:#6b7280; stroke-width:2; fill:none; marker-end:url(#m2)}
      .pill{fill:#eef2ff; stroke:#c7d2fe; stroke-width:1.5}
    </style>
    <marker id="m" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L10,3 L0,6 Z" fill="#111827"/>
    </marker>
    <marker id="m2" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L10,3 L0,6 Z" fill="#6b7280"/>
    </marker>
  </defs>

  <rect x="0" y="0" width="1200" height="720" fill="#ffffff"/>
  <text x="40" y="52" class="t1">编程问答匹配与回答推荐系统（B/S 架构）</text>
  <text x="40" y="78" class="t3">前端 Vue3 + 后端 Django REST + MySQL + 外部大模型（Qwen OpenAI 兼容接口）</text>

  <!-- Client -->
  <rect x="40" y="120" width="320" height="220" rx="14" class="box"/>
  <text x="60" y="150" class="t2">客户端（浏览器）</text>
  <rect x="60" y="172" width="280" height="64" rx="12" class="box2"/>
  <text x="78" y="202" class="t4">UI（Vue3 + Naive UI）</text>
  <text x="78" y="222" class="t3">登录 / 编程问答 / 数据集浏览 / 仪表盘</text>
  <rect x="60" y="248" width="280" height="76" rx="12" class="box2"/>
  <text x="78" y="280" class="t4">HTTP 客户端</text>
  <text x="78" y="300" class="t3">Token 鉴权 + REST API 调用</text>

  <!-- Backend -->
  <rect x="420" y="120" width="460" height="520" rx="14" class="box"/>
  <text x="440" y="150" class="t2">服务端（Django + DRF）</text>

  <rect x="440" y="172" width="420" height="124" rx="12" class="box2"/>
  <text x="458" y="202" class="t4">API 层</text>
  <text x="458" y="222" class="t3">/api/auth/*（登录/注册/Me）</text>
  <text x="458" y="242" class="t3">/api/qa/*（问答、会话、匹配推荐、数据集浏览）</text>
  <text x="458" y="262" class="t3">/api/utils/*（文件上传/下载）</text>

  <rect x="440" y="312" width="420" height="152" rx="12" class="box2"/>
  <text x="458" y="342" class="t4">业务服务层</text>
  <text x="458" y="362" class="t3">django_auth：Token 鉴权、权限控制、统一异常响应</text>
  <text x="458" y="382" class="t3">django_qa：会话消息、提示词模板、问答生成</text>
  <text x="458" y="402" class="t3">匹配推荐：TF-IDF 召回 + 质量评分 + 融合排序</text>
  <text x="458" y="422" class="t3">数据导入：清洗数据 JSONL → ProgrammingQAPair 入库</text>

  <rect x="440" y="480" width="420" height="140" rx="12" class="box2"/>
  <text x="458" y="510" class="t4">支撑组件</text>
  <text x="458" y="530" class="t3">Prompt 渲染：模板变量注入（question/context）</text>
  <text x="458" y="550" class="t3">代码评估：AST + pylint（语法/逻辑/通用性/可读性）</text>
  <text x="458" y="570" class="t3">数据缓存：TF-IDF 索引 joblib（output/qa_index）</text>

  <!-- Data stores -->
  <rect x="930" y="120" width="230" height="220" rx="14" class="box"/>
  <text x="950" y="150" class="t2">数据存储</text>
  <rect x="950" y="172" width="190" height="70" rx="12" class="box2"/>
  <text x="968" y="202" class="t4">MySQL</text>
  <text x="968" y="222" class="t3">业务表：会话/消息/评估/数据集</text>
  <rect x="950" y="254" width="190" height="70" rx="12" class="box2"/>
  <text x="968" y="284" class="t4">文件存储</text>
  <text x="968" y="304" class="t3">media/uploads（用户文件）</text>

  <!-- External -->
  <rect x="930" y="380" width="230" height="260" rx="14" class="box"/>
  <text x="950" y="410" class="t2">外部能力</text>
  <rect x="950" y="432" width="190" height="78" rx="12" class="box2"/>
  <text x="968" y="462" class="t4">Qwen API</text>
  <text x="968" y="482" class="t3">OpenAI 兼容 Chat Completions</text>
  <rect x="950" y="522" width="190" height="96" rx="12" class="box2"/>
  <text x="968" y="552" class="t4">静态分析工具</text>
  <text x="968" y="572" class="t3">pylint / Python AST</text>
  <text x="968" y="592" class="t3">生成质量评分与报告</text>

  <!-- Arrows -->
  <path d="M360,230 C390,230 395,230 420,230" class="arrow"/>
  <text x="370" y="214" class="t3">HTTPS / REST</text>
  <text x="370" y="250" class="t3">Token: Authorization</text>

  <path d="M880,240 C905,240 910,240 930,240" class="arrow"/>
  <text x="888" y="222" class="t3">读写</text>

  <path d="M650,640 C650,680 930,680 930,620" class="arrow2"/>
  <text x="700" y="690" class="t3">批处理/缓存（索引与导入）</text>

  <path d="M860,520 C900,520 900,470 930,470" class="arrow"/>
  <text x="872" y="500" class="t3">调用</text>

  <path d="M860,560 C900,560 900,570 930,570" class="arrow2"/>
  <text x="872" y="544" class="t3">评估</text>

  <!-- Legend -->
  <rect x="40" y="370" width="320" height="270" rx="14" class="box2"/>
  <text x="60" y="402" class="t2">核心功能点</text>
  <rect x="60" y="420" width="280" height="40" rx="999" class="pill"/>
  <text x="74" y="446" class="t3">问答生成：提示词模板 + 上下文 + 大模型</text>
  <rect x="60" y="470" width="280" height="40" rx="999" class="pill"/>
  <text x="74" y="496" class="t3">问答匹配：TF-IDF 向量召回 Top-K</text>
  <rect x="60" y="520" width="280" height="40" rx="999" class="pill"/>
  <text x="74" y="546" class="t3">回答推荐：质量评分 + upvotes + 相似度融合</text>
  <rect x="60" y="570" width="280" height="40" rx="999" class="pill"/>
  <text x="74" y="596" class="t3">数据集：JSONL 导入 + 前端可视化浏览</text>
</svg>
